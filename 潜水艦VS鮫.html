<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>æ½œæ°´è‰¦VSã‚µãƒ¡</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      touch-action: none;
      background-color: #0a3258;
      font-family: Arial, sans-serif;
    }
    #gameCanvas {
      display: block;
      width: 100%;
      height: 100vh;
      background: linear-gradient(to bottom, #1a95d5 0%, #0a3258 70%, #072038 100%);
    }
    #startScreen, #gameOverScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: rgba(10, 50, 88, 0.8);
      color: white;
      z-index: 100;
    }
    #gameOverScreen {
      display: none;
    }
    button {
      background-color: #ff6b00;
      color: white;
      border: none;
      padding: 15px 32px;
      text-align: center;
      text-decoration: none;
      font-size: 20px;
      margin: 20px;
      cursor: pointer;
      border-radius: 10px;
    }
    #score, #hpDisplay {
      position: absolute;
      top: 10px;
      color: white;
      font-size: 24px;
      z-index: 50;
    }
    #score { left: 10px; }
    #hpDisplay { right: 10px; }
    /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ç¾¤ï¼ˆä¸Šä¸‹å·¦å³ï¼‹ç™ºå°„ï¼‰ */
    #controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: grid;
      grid-template-columns: repeat(3, 60px);
      grid-template-rows: repeat(2, 60px);
      gap: 10px;
      z-index: 50;
    }
    .control-btn {
      width: 60px;
      height: 60px;
      background-color: rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      color: white;
      user-select: none;
    }
    /* é…ç½®èª¿æ•´ï¼ˆçœŸã‚“ä¸­ã«ç©ºç™½ã®ã‚»ãƒ«ï¼‰ */
    #upBtn { grid-column: 2; grid-row: 1; }
    #leftBtn { grid-column: 1; grid-row: 2; }
    #downBtn { grid-column: 2; grid-row: 2; }
    #rightBtn { grid-column: 3; grid-row: 2; }
    #fireBtn { grid-column: 3; grid-row: 1; }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  
  <div id="score">ã‚¹ã‚³ã‚¢: 0</div>
  <div id="hpDisplay">HP: 100</div>
  
  <div id="controls">
    <div class="control-btn" id="upBtn">â†‘</div>
    <div class="control-btn" id="fireBtn">ğŸ”¥</div>
    <div class="control-btn" id="leftBtn">â†</div>
    <div class="control-btn" id="downBtn">â†“</div>
    <div class="control-btn" id="rightBtn">â†’</div>
  </div>
  
  <div id="startScreen">
    <h1>æ½œæ°´è‰¦VSã‚µãƒ¡</h1>
    <p>æ“ä½œæ–¹æ³•: çŸ¢å°ãƒœã‚¿ãƒ³ã§æ½œæ°´è‰¦ã‚’ç§»å‹•ã—ã€ğŸ”¥ãƒœã‚¿ãƒ³ã§ãƒŸã‚µã‚¤ãƒ«ã‚’ç™ºå°„ã—ã¦ã‚µãƒ¡ã‚’å€’ãã†ï¼</p>
    <button id="startBtn">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
  </div>
  
  <div id="gameOverScreen">
    <h1>ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</h1>
    <h2 id="finalScore">ã‚¹ã‚³ã‚¢: 0</h2>
    <button id="restartBtn">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
  </div>
  
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const scoreDisplay = document.getElementById('score');
    const hpDisplay = document.getElementById('hpDisplay');
    const finalScoreDisplay = document.getElementById('finalScore');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    const upBtn = document.getElementById('upBtn');
    const downBtn = document.getElementById('downBtn');
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');
    const fireBtn = document.getElementById('fireBtn');

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    
    let gameRunning = false;
    let score = 0;
    let playerHP = 100;
    
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆæ½œæ°´è‰¦ï¼‰ã®è¨­å®šï¼ˆç„¡æ•µãƒ•ãƒ©ã‚°ãƒ»ã‚¿ã‚¤ãƒãƒ¼è¿½åŠ ï¼‰
    const submarine = {
      x: 50,
      y: canvas.height / 2,
      width: 80,
      height: 30,
      speed: 5,
      color: '#0077cc',
      invincible: false,
      invincibleUntil: 0,
      move: function(direction) {
        if (direction === 'up' && this.y > 30) {
          this.y -= this.speed;
        } else if (direction === 'down' && this.y < canvas.height - this.height) {
          this.y += this.speed;
        } else if (direction === 'left' && this.x > 0) {
          this.x -= this.speed;
        } else if (direction === 'right' && this.x < canvas.width - this.width) {
          this.x += this.speed;
        }
      },
      draw: function() {
        // ç„¡æ•µæ™‚ã®ã‚°ãƒ­ãƒ¼è¡¨ç¤º
        if (this.invincible) {
          ctx.save();
          ctx.strokeStyle = 'gold';
          ctx.lineWidth = 5;
          ctx.beginPath();
          ctx.ellipse(this.x, this.y, this.width/2 + 10, this.height/2 + 10, 0, 0, Math.PI * 2);
          ctx.stroke();
          ctx.restore();
        }
        // æ½œæ°´è‰¦æœ¬ä½“
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.ellipse(this.x, this.y, this.width / 2, this.height / 2, 0, 0, Math.PI * 2);
        ctx.fill();
        
        const gradient = ctx.createLinearGradient(
          this.x - this.width / 2,
          this.y - this.height / 2,
          this.x + this.width / 2,
          this.y + this.height / 2
        );
        gradient.addColorStop(0, 'rgba(255, 255, 255, 0.7)');
        gradient.addColorStop(0.5, 'rgba(255, 255, 255, 0)');
        gradient.addColorStop(1, 'rgba(0, 0, 0, 0.3)');
        
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.ellipse(this.x, this.y, this.width / 2, this.height / 2, 0, 0, Math.PI * 2);
        ctx.fill();
        
        // å…ˆç«¯éƒ¨åˆ†
        ctx.fillStyle = '#004080';
        ctx.beginPath();
        ctx.moveTo(this.x + this.width / 2, this.y);
        ctx.lineTo(this.x + this.width / 2 + 15, this.y);
        ctx.lineTo(this.x + this.width / 2, this.y + this.height / 3);
        ctx.fill();
        
        // å¾Œéƒ¨ãƒ—ãƒ­ãƒšãƒ©
        ctx.fillStyle = '#666666';
        ctx.beginPath();
        ctx.moveTo(this.x - this.width / 2, this.y - this.height / 3);
        ctx.lineTo(this.x - this.width / 2 - 10, this.y - this.height / 2);
        ctx.lineTo(this.x - this.width / 2 - 10, this.y + this.height / 2);
        ctx.lineTo(this.x - this.width / 2, this.y + this.height / 3);
        ctx.fill();
        
        // æ½œæœ›é¡
        ctx.fillStyle = '#ff6600';
        ctx.fillRect(this.x + 10, this.y - this.height / 2 - 15, 5, 15);
        ctx.fillStyle = '#004080';
        ctx.fillRect(this.x + 8, this.y - this.height / 2 - 20, 9, 5);
        
        // çª“
        ctx.fillStyle = '#80dfff';
        ctx.beginPath();
        ctx.arc(this.x + 15, this.y, 5, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = '#004080';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.arc(this.x + 15, this.y, 5, 0, Math.PI * 2);
        ctx.stroke();
        
        // è‰¦ä½“ã®ãƒ‡ã‚£ãƒ†ãƒ¼ãƒ«
        ctx.strokeStyle = '#004080';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(this.x - this.width / 3, this.y - this.height / 3);
        ctx.lineTo(this.x + this.width / 3, this.y - this.height / 3);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(this.x - this.width / 3, this.y + this.height / 3);
        ctx.lineTo(this.x + this.width / 3, this.y + this.height / 3);
        ctx.stroke();
      }
    };
    
    let missiles = [];
    const missileSpeed = 10;
    function createMissile() {
      missiles.push({
        x: submarine.x + submarine.width / 2,
        y: submarine.y,
        width: 20,
        height: 5,
        speed: missileSpeed
      });
    }
    
    let sharks = [];
    const sharkSpawnRate = 100;
    let sharkSpeed = 2;
    function createShark() {
      const size = 20 + Math.random() * 30;
      sharks.push({
        x: canvas.width + size,
        y: Math.random() * (canvas.height - size * 2) + size,
        width: size * 2,
        height: size,
        speed: 1 + Math.random() * sharkSpeed,
        hp: Math.ceil(size / 10)
      });
    }
    
    // æ–°æ©Ÿèƒ½ï¼šãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ï¼ˆç„¡æ•µã‚¢ã‚¤ãƒ†ãƒ ï¼‰
    let powerUps = [];
    function createPowerUp() {
      const size = 20;
      powerUps.push({
        x: canvas.width + size,
        y: Math.random() * (canvas.height - size * 2) + size,
        width: size,
        height: size,
        speed: 2
      });
    }
    
    // è¡çªåˆ¤å®šï¼ˆAABBæ–¹å¼ï¼‰
    function checkCollision(obj1, obj2) {
      return obj1.x < obj2.x + obj2.width &&
             obj1.x + obj1.width > obj2.x &&
             obj1.y < obj2.y + obj2.height &&
             obj1.y + obj1.height > obj2.y;
    }
    
    // æ³¡ã®è¨­å®šã¨æç”»
    let bubbles = [];
    function createBubbles() {
      for (let i = 0; i < 50; i++) {
        bubbles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          radius: Math.random() * 5 + 1,
          speed: Math.random() * 2 + 0.5
        });
      }
    }
    function drawBubbles() {
      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
      bubbles.forEach(bubble => {
        ctx.beginPath();
        ctx.arc(bubble.x, bubble.y, bubble.radius, 0, Math.PI * 2);
        ctx.fill();
        bubble.y -= bubble.speed;
        if (bubble.y + bubble.radius < 0) {
          bubble.y = canvas.height + bubble.radius;
          bubble.x = Math.random() * canvas.width;
        }
      });
    }
    
    // ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ã®æç”»
    function drawPowerUps() {
      powerUps.forEach(powerUp => {
        ctx.fillStyle = '#ffff00';
        ctx.beginPath();
        ctx.arc(powerUp.x + powerUp.width/2, powerUp.y + powerUp.height/2, powerUp.width/2, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = '#ffcc00';
        ctx.lineWidth = 2;
        ctx.stroke();
      });
    }
    
    // å…¥åŠ›ç®¡ç†ç”¨ãƒ•ãƒ©ã‚°
    let upPressed = false;
    let downPressed = false;
    let leftPressed = false;
    let rightPressed = false;
    
    // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆ
    upBtn.addEventListener('touchstart', e => { e.preventDefault(); upPressed = true; });
    upBtn.addEventListener('touchend', e => { e.preventDefault(); upPressed = false; });
    downBtn.addEventListener('touchstart', e => { e.preventDefault(); downPressed = true; });
    downBtn.addEventListener('touchend', e => { e.preventDefault(); downPressed = false; });
    leftBtn.addEventListener('touchstart', e => { e.preventDefault(); leftPressed = true; });
    leftBtn.addEventListener('touchend', e => { e.preventDefault(); leftPressed = false; });
    rightBtn.addEventListener('touchstart', e => { e.preventDefault(); rightPressed = true; });
    rightBtn.addEventListener('touchend', e => { e.preventDefault(); rightPressed = false; });
    fireBtn.addEventListener('touchstart', e => { e.preventDefault(); if (gameRunning) createMissile(); });
    
    // ãƒã‚¦ã‚¹ï¼ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆPCå‘ã‘ï¼‰
    upBtn.addEventListener('mousedown', e => { e.preventDefault(); upPressed = true; });
    upBtn.addEventListener('mouseup', e => { e.preventDefault(); upPressed = false; });
    upBtn.addEventListener('mouseleave', e => { e.preventDefault(); upPressed = false; });
    downBtn.addEventListener('mousedown', e => { e.preventDefault(); downPressed = true; });
    downBtn.addEventListener('mouseup', e => { e.preventDefault(); downPressed = false; });
    downBtn.addEventListener('mouseleave', e => { e.preventDefault(); downPressed = false; });
    leftBtn.addEventListener('mousedown', e => { e.preventDefault(); leftPressed = true; });
    leftBtn.addEventListener('mouseup', e => { e.preventDefault(); leftPressed = false; });
    leftBtn.addEventListener('mouseleave', e => { e.preventDefault(); leftPressed = false; });
    rightBtn.addEventListener('mousedown', e => { e.preventDefault(); rightPressed = true; });
    rightBtn.addEventListener('mouseup', e => { e.preventDefault(); rightPressed = false; });
    rightBtn.addEventListener('mouseleave', e => { e.preventDefault(); rightPressed = false; });
    fireBtn.addEventListener('mousedown', e => { e.preventDefault(); if (gameRunning) createMissile(); });
    
    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ
    window.addEventListener('keydown', e => {
      if (e.key === 'ArrowUp') {
        upPressed = true;
      } else if (e.key === 'ArrowDown') {
        downPressed = true;
      } else if (e.key === 'ArrowLeft') {
        leftPressed = true;
      } else if (e.key === 'ArrowRight') {
        rightPressed = true;
      } else if (e.key === ' ' && gameRunning) {
        createMissile();
      }
    });
    window.addEventListener('keyup', e => {
      if (e.key === 'ArrowUp') upPressed = false;
      else if (e.key === 'ArrowDown') downPressed = false;
      else if (e.key === 'ArrowLeft') leftPressed = false;
      else if (e.key === 'ArrowRight') rightPressed = false;
    });
    
    function update() {
      if (!gameRunning) return;
      
      // ç„¡æ•µçŠ¶æ…‹ã®æ›´æ–°
      if (submarine.invincibleUntil && performance.now() < submarine.invincibleUntil) {
        submarine.invincible = true;
      } else {
        submarine.invincible = false;
      }
      
      // ã‚­ãƒ¼å…¥åŠ›ã«ã‚ˆã‚‹ç§»å‹•ï¼ˆä¸Šä¸‹å·¦å³ï¼‰
      if (upPressed) submarine.move('up');
      if (downPressed) submarine.move('down');
      if (leftPressed) submarine.move('left');
      if (rightPressed) submarine.move('right');
      
      // ã‚µãƒ¡ã®ç”Ÿæˆ
      if (Math.random() * 1000 < sharkSpawnRate) createShark();
      // ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ã®ç”Ÿæˆï¼ˆä½ç¢ºç‡ã§å‡ºç¾ï¼‰
      if (Math.random() < 0.001) createPowerUp();
      
      // ãƒŸã‚µã‚¤ãƒ«ã®ç§»å‹•
      for (let i = missiles.length - 1; i >= 0; i--) {
        missiles[i].x += missiles[i].speed;
        if (missiles[i].x > canvas.width) missiles.splice(i, 1);
      }
      
      // ã‚µãƒ¡ã®ç§»å‹•ã¨è¡çªåˆ¤å®š
      for (let i = sharks.length - 1; i >= 0; i--) {
        sharks[i].x -= sharks[i].speed;
        if (sharks[i].x + sharks[i].width < 0) {
          sharks.splice(i, 1);
          continue;
        }
        // æ½œæ°´è‰¦ã¨ã®è¡çªï¼ˆç„¡æ•µä¸­ã¯ãƒ€ãƒ¡ãƒ¼ã‚¸ç„¡ã—ï¼‰
        if (checkCollision(submarine, sharks[i])) {
          if (!submarine.invincible) {
            playerHP -= 10;
            hpDisplay.textContent = `HP: ${playerHP}`;
            if (playerHP <= 0) gameOver();
          }
          sharks.splice(i, 1);
          continue;
        }
        // ãƒŸã‚µã‚¤ãƒ«ã¨ã®è¡çªåˆ¤å®š
        for (let j = missiles.length - 1; j >= 0; j--) {
          if (checkCollision(missiles[j], sharks[i])) {
            sharks[i].hp--;
            missiles.splice(j, 1);
            if (sharks[i].hp <= 0) {
              score += Math.floor(sharks[i].width);
              scoreDisplay.textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
              sharks.splice(i, 1);
            }
            break;
          }
        }
      }
      
      // ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ã®ç§»å‹•ã¨å–å¾—åˆ¤å®š
      for (let i = powerUps.length - 1; i >= 0; i--) {
        powerUps[i].x -= powerUps[i].speed;
        if (powerUps[i].x + powerUps[i].width < 0) {
          powerUps.splice(i, 1);
          continue;
        }
        if (checkCollision(submarine, powerUps[i])) {
          submarine.invincibleUntil = performance.now() + 5000; // 5ç§’é–“ç„¡æ•µ
          powerUps.splice(i, 1);
        }
      }
      
      // é›£æ˜“åº¦ã®æ›´æ–°ï¼šã‚¹ã‚³ã‚¢ã«å¿œã˜ã¦ã‚µãƒ¡ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒä¸Šæ˜‡
      sharkSpeed = 2 + Math.floor(score / 500);
    }
    
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBubbles();
      submarine.draw();
      missiles.forEach(missile => {
        ctx.fillStyle = '#ff3300';
        ctx.beginPath();
        ctx.moveTo(missile.x, missile.y);
        ctx.lineTo(missile.x + missile.width, missile.y + missile.height / 2);
        ctx.lineTo(missile.x, missile.y + missile.height);
        ctx.fill();
        ctx.fillStyle = '#cc0000';
        ctx.beginPath();
        ctx.arc(missile.x + missile.width, missile.y + missile.height / 2, missile.height, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = 'rgba(255, 165, 0, 0.7)';
        ctx.beginPath();
        ctx.moveTo(missile.x, missile.y);
        ctx.lineTo(missile.x - 15, missile.y - 3);
        ctx.lineTo(missile.x - 5, missile.y + missile.height / 2);
        ctx.lineTo(missile.x - 15, missile.y + missile.height + 3);
        ctx.lineTo(missile.x, missile.y + missile.height);
        ctx.fill();
      });
      sharks.forEach(shark => {
        const centerX = shark.x + shark.width / 2;
        const centerY = shark.y + shark.height / 2;
        const sharkGradient = ctx.createLinearGradient(
          shark.x, centerY - shark.height / 2,
          shark.x, centerY + shark.height / 2
        );
        sharkGradient.addColorStop(0, '#a0a0a0');
        sharkGradient.addColorStop(0.5, '#505050');
        sharkGradient.addColorStop(1, '#303030');
        ctx.fillStyle = sharkGradient;
        ctx.beginPath();
        ctx.moveTo(shark.x, centerY);
        ctx.quadraticCurveTo(centerX, centerY - shark.height, shark.x + shark.width, centerY);
        ctx.quadraticCurveTo(centerX, centerY + shark.height, shark.x, centerY);
        ctx.fill();
        // å„ãƒ‘ãƒ¼ãƒ„ã®æç”»ï¼ˆèƒŒã³ã‚Œãƒ»å°¾ã³ã‚Œãƒ»æ¨ªã³ã‚Œãªã©ï¼‰
        ctx.fillStyle = '#303030';
        ctx.beginPath();
        ctx.moveTo(centerX - shark.width / 6, centerY - shark.height / 3);
        ctx.lineTo(centerX, centerY - shark.height * 1.2);
        ctx.lineTo(centerX + shark.width / 6, centerY - shark.height / 3);
        ctx.fill();
        ctx.fillStyle = '#404040';
        ctx.beginPath();
        ctx.moveTo(shark.x + shark.width, centerY - shark.height / 4);
        ctx.lineTo(shark.x + shark.width + shark.width / 3, centerY - shark.height / 2);
        ctx.lineTo(shark.x + shark.width + shark.width / 3, centerY + shark.height / 2);
        ctx.lineTo(shark.x + shark.width, centerY + shark.height / 4);
        ctx.fill();
        ctx.fillStyle = '#505050';
        ctx.beginPath();
        ctx.moveTo(centerX, centerY + shark.height / 3);
        ctx.lineTo(centerX - shark.width / 8, centerY + shark.height);
        ctx.lineTo(centerX + shark.width / 8, centerY + shark.height / 3);
        ctx.fill();
        ctx.fillStyle = 'white';
        ctx.beginPath();
        ctx.arc(shark.x + shark.width / 6, centerY - shark.height / 6, shark.height / 6, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = 'black';
        ctx.beginPath();
        ctx.arc(shark.x + shark.width / 6, centerY - shark.height / 6, shark.height / 10, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = 'white';
        ctx.beginPath();
        ctx.arc(shark.x + shark.width / 7, centerY - shark.height / 5, shark.height / 25, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#800000';
        ctx.beginPath();
        ctx.moveTo(shark.x, centerY);
        ctx.lineTo(shark.x - shark.width / 6, centerY - shark.height / 6);
        ctx.lineTo(shark.x, centerY - shark.height / 12);
        ctx.lineTo(shark.x - shark.width / 6, centerY);
        ctx.lineTo(shark.x, centerY + shark.height / 12);
        ctx.lineTo(shark.x - shark.width / 6, centerY + shark.height / 6);
        ctx.lineTo(shark.x, centerY);
        ctx.fill();
        const teethSize = shark.height / 15;
        for (let i = 0; i < 3; i++) {
          ctx.beginPath();
          ctx.moveTo(shark.x - teethSize * i, centerY - teethSize * (i+1));
          ctx.lineTo(shark.x - teethSize * (i+1), centerY - teethSize * (i+2));
          ctx.lineTo(shark.x - teethSize * (i+2), centerY - teethSize * (i+1));
          ctx.fill();
          ctx.beginPath();
          ctx.moveTo(shark.x - teethSize * i, centerY + teethSize * (i+1));
          ctx.lineTo(shark.x - teethSize * (i+1), centerY + teethSize * (i+2));
          ctx.lineTo(shark.x - teethSize * (i+2), centerY + teethSize * (i+1));
          ctx.fill();
        }
        ctx.strokeStyle = '#303030';
        ctx.lineWidth = 2;
        for (let i = 1; i <= 3; i++) {
          ctx.beginPath();
          ctx.moveTo(shark.x + shark.width / 4 + i * shark.width / 12, centerY - shark.height / 3);
          ctx.lineTo(shark.x + shark.width / 4 + i * shark.width / 12, centerY + shark.height / 3);
          ctx.stroke();
        }
      });
      drawPowerUps();
    }
    
    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }
    
    function startGame() {
      gameRunning = true;
      score = 0;
      playerHP = 100;
      missiles = [];
      sharks = [];
      powerUps = [];
      submarine.x = 50;
      submarine.y = canvas.height / 2;
      submarine.invincible = false;
      submarine.invincibleUntil = 0;
      scoreDisplay.textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
      hpDisplay.textContent = `HP: ${playerHP}`;
      startScreen.style.display = 'none';
      gameOverScreen.style.display = 'none';
    }
    
    function gameOver() {
      gameRunning = false;
      finalScoreDisplay.textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
      gameOverScreen.style.display = 'flex';
    }
    
    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);
    
    window.addEventListener('load', () => {
      resizeCanvas();
      createBubbles();
      gameLoop();
    });
    window.addEventListener('resize', resizeCanvas);
  </script>
</body>
</html>
